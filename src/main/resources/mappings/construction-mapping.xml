<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ConstructionDAO">
	<!-- 공사 접수 -->
	<insert id="insertConstruction">
		INSERT INTO construction(con_seq, con_name, sido, gugun, dong, address,
								 cp_name, cp_num, start_date, end_date, con_size, 
								 con_state, con_num, dept, dept_tel, content) 
		VALUES(con_seq.NEXTVAL, #{con_name}, #{sido}, #{gugun}, #{dong},
			   #{address}, #{cp_name}, #{cp_num}, #{start_date}, #{end_date},
			   #{con_size}, #{con_state}, #{con_num}, #{dept}, #{dept_tel}, #{content})
	</insert>
	
	<!-- 공사 수정 -->
	<update id="updateConstruction">
		UPDATE construction 
		SET start_date=#{start_date}, end_date=#{end_date}, con_num=#{con_num},
			con_size=#{con_size}, con_state=#{con_state}, dept=#{dept}, dept_tel=#{dept_tel}
		WHERE con_seq=#{con_seq}
	</update>
	
	<!-- 공사 삭제 -->
	<delete id="deleteConstruction">
		DELETE construction WHERE con_seq=#{con_seq}
	</delete>
	
	<!-- 공사 가져오기 -->
	<select id="getConstruction" resultType="construction">
		SELECT * FROM construction WHERE con_seq=#{con_seq}
	</select>
	
	<!-- 전체 공사 리스트 -->
	<select id="getConstructionList" resultType="construction">
		SELECT * FROM construction
	</select>
	
	<!-- 지역으로 공사 찾기 -->
	<select id="getConstructionListByArea" parameterType="HashMap" resultType="construction">
		SELECT *
		FROM construction 
		WHERE sido=#{sido}
		AND gugun LIKE '%'||#{gugun}||'%'
		AND dong LIKE '%'||#{dong}||'%'
	</select>
	
	<!-- 관리 지역 리스트 찾기 -->
	<select id="getManageConstructionList" parameterType="HashMap" resultType="construction">
		SELECT *
		FROM construction
		WHERE sido=#{sido}
		AND gugun LIKE '%'||#{gugun}||'%'
	</select>
	
	<!-- keyword로 지역 리스트 찾기 -->
	<select id="getConstructionListByKey" parameterType="HashMap" resultType="construction">
		SELECT *
		FROM construction
		WHERE gugun LIKE '%'||#{keyArea}||'%'
		OR dong LIKE '%'||#{keyArea}||'%'
		OR con_name LIKE '%'||#{keyTitle}||'%'
	</select>
	
	<!-- 메인 페이지에서 최신 5개의 공사현황 전시-->
	<select id="mainConstructionList" resultType="construction">
		<![CDATA[
		SELECT con_seq, con_name, regdate
		FROM
    		(SELECT ROW_NUMBER() OVER(ORDER BY regdate DESC) con_seq, con_name, title, regdate
     		 FROM construction)    
		WHERE rn > 0 AND rn <=5;
		]]>
	</select>
	
	<!-- 공사 종류로 공사찾기 -->
	<select id="getConstructionListByConNum" parameterType="String" resultType="construction">
		SELECT * FROM construction WHERE con_num=#{con_num}
	</select>
</mapper>